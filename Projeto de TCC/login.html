<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Registro de Manuten√ß√£o - Blockchain</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>
</head>
<body style="font-family: Arial; padding: 20px;">
  <h2>Registro de Manuten√ß√£o - Blockchain</h2>

  <button id="connectBtn">üîó Conectar MetaMask</button>
  <p id="account"></p>

  <h3>Registrar manuten√ß√£o</h3>
  <input id="equipId" placeholder="ID do equipamento" />
  <input id="desc" placeholder="Descri√ß√£o" />
  <button id="registerBtn">Registrar</button>

  <h3>Consultar manuten√ß√£o</h3>
  <input id="searchId" placeholder="ID do registro" />
  <button id="searchBtn">Buscar</button>
  <pre id="result"></pre>

  <script>
    const contractAddress = "COLE_SEU_ENDERECO_AQUI";
    const abi = [
      "function registerMaintenance(string,string) public",
      "function getMaintenance(uint256) public view returns (tuple(uint256,address,uint256,string,string))",
      "function getLatestId() public view returns (uint256)"
    ];

    let provider, signer, contract;

    async function connectWallet() {
      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      const account = await signer.getAddress();
      document.getElementById("account").textContent = "Conectado: " + account;
      contract = new ethers.Contract(contractAddress, abi, signer);
    }

    async function registerMaintenance() {
      const equip = document.getElementById("equipId").value;
      const desc = document.getElementById("desc").value;
      const tx = await contract.registerMaintenance(equip, desc);
      await tx.wait();
      alert("Manuten√ß√£o registrada!");
    }

    async function searchMaintenance() {
      const id = document.getElementById("searchId").value;
      const data = await contract.getMaintenance(id);
      document.getElementById("result").textContent = JSON.stringify(data, null, 2);
    }

    document.getElementById("connectBtn").onclick = connectWallet;
    document.getElementById("registerBtn").onclick = registerMaintenance;
    document.getElementById("searchBtn").onclick = searchMaintenance;
  </script>
</body>
</html>